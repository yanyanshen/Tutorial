<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>我的资料</title>
    <link href="__SKIN__/Home/css/common.css" rel="stylesheet" tyle="text/css" />
    <link href="__SKIN__/Home/css/style.css" rel="stylesheet" type="text/css" />
    <link href="__SKIN__/Home/css/iconfont.css" rel="stylesheet" type="text/css" />
    <link href="__SKIN__/Home/css/Orders.css" rel="stylesheet" type="text/css" />
    <link href="__SKIN__/Home/css/style.css" rel="stylesheet" type="text/css" />
    <link href="__SKIN__/Home/css/select.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" href="__SKIN__/Home/css/webuploader.css" />
    <script src="__SKIN__/Home/js/jquery-1.8.2.min.js" type="text/javascript"></script>
    <script src="__SKIN__/Home/js/jquery.SuperSlide.2.1.1.js" type="text/javascript"></script>
    <script src="__SKIN__/Home/js/common_js.js" type="text/javascript"></script>
    <script src="__SKIN__/Home/js/footer.js" type="text/javascript"></script>
    <script src="__SKIN__/Home/js/layer.js" type="text/javascript"></script>
    <script type="text/javascript" src="__SKIN__/Home/js/jquery.form.js"></script>
    <script type="text/javascript" src="__SKIN__/Home/js/jquery.idTabs.min.js"></script>
    <script type="text/javascript" src="__SKIN__/Home/js/select-ui.min.js"></script>
    <script type="text/javascript" src="__SKIN__/Home/js/webuploader.js"></script>
    <script type="text/javascript" src="__SKIN__/Home/js/upload.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            setInterval(showTime, 1000);
            function timer(obj,txt){
                obj.text(txt);
            }
            function showTime(){
                var today = new Date();
                var weekday=new Array(7)
                weekday[0]="星期日"
                weekday[1]="星期一"
                weekday[2]="星期二"
                weekday[3]="星期三"
                weekday[4]="星期四"
                weekday[5]="星期五"
                weekday[6]="星期六"
                var y=today.getFullYear()+"年";
                var month=today.getMonth()+1+"月";
                var td=today.getDate();
                var d=weekday[today.getDay()];
                var h=today.getHours();
                var m=today.getMinutes();
                var s=today.getSeconds();
                timer($("#y"),y+month);
                //timer($("#MH"),month);
                timer($("h1"),td);
                timer($("#D"),d);
                timer($("#H"),h);
                timer($("#M"),m);
                timer($("#S"),s);
            }
        })
        $(function(){
            $(document).ready(function(){
                option={
                    url:"{:U('Member/memberEdit')}",
                    type: "post",
                    success: shows,
                    error: showe
                }
            })
            $("#form1").submit(function(){
                $(this).ajaxSubmit(option);
                return false;
            })
            function shows(res){
                if(res.status==1) {
                    layer.msg("更改成功",{icon:1,time:800},function(){
                        location.reload();
                    });
                }else{
                    layer.msg("更改失败！",{icon:5,time:1000},function(){
                    });
                }
            }
            function showe(res){
                if(res.status==0) {
                    layer.msg("更改失败！",{icon:5,time:1200},function(){
                        location.href="{:U('Member/memberEdit')}";
                    });
                }
            }
        })
    </script>


    <style type="text/css">
        .pwd{
            width: 100%;
            height: 260px;
        }
        .user_address .save{
            text-align: center;
            line-height: 70px;
            margin-top: 50px;
            font-size: 20px;
        }
    </style>
</head>
<body>
<!--顶部样式-->
<include file="Shop/Home/Common/header.html"/>
<!--菜单导航样式-->
<include file="Shop/Home/Common/topMenu.html"/>
<!--内页样式-->
<div class="user_style clearfix" id="user">
    <!--用户中心布局样式-->
    <include file="Shop/Home/View/Member/public.html"/>
    <!--右侧样式布局-->
    <div class="right_style r_user_style">
        <!--地址管理-->
        <div class="user_address">
            <div class="title_name"> <span class="name">资料管理</span></div>
            <link href="Threelinkage/linkage.css" rel="stylesheet"  type="text/css"/>
                <div class="Add_Addresss">
                    <table style="width: 500px;float: left">
                        <tr>
                            <td class="label_name">头&nbsp;像：</td>
                            <if condition="$amod['avatar'] neq ''">
                                <td><img src="/uploads/avatar/{$amod['avatar']}" width="100" height="100" /></td>
                                <else />
                                <td><img src="/uploads/avatar/a.jpg" width="100" height="100" /></td>
                            </if>
                            <!--<td>-->
                                <!--<img src="/uploads/avatar/{$amod['avatar']}" style="width: 100px;height: 100px;" alt="头像"/>-->
                            <!--</td>-->
                        </tr>
                        <tr>
                            <td class="label_name">姓&nbsp;名：</td>
                            <td>
                                <input name="username" value="{$amod['username']}" type="text"  class="Add-text"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="label_name">积&nbsp;分：</td>
                            <td>
                                <input name="jifen" value="{$amod['jifen']}" type="text"  class="Add-text"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="label_name">余&nbsp;额：</td>
                            <td>
                                <input name="money" value="{$amod['money']}" type="text"  class="Add-text"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="label_name">手&nbsp;机：</td>
                            <td>
                                <input name="mobile" id="tel" value="{$Think.session.mobile}" type="text"  class="Add-text"/>
                            </td>
                        </tr>
                        <tr>
                            <td class="label_name">登录次数：</td>
                            <td>
                                <input name="loginnum" value="{$amod['loginnum']}" type="text"  class="Add-text"/>
                            </td>
                        </tr>
                    </table>
                    <form action="" method="get" enctype="multipart/form-data" id="form1">
                        <table style="width: 220px;float: left;margin-left: 140px">
                            <input type="hidden" value="{$amod['id']}" name="av_id"/>
                            <tr>
                                <td style="border: hidden;">
                                    <div class="usercity" style="border:3px dashed #e6e6e6;width:200px;height:200px;position: relative;float: left;">
                                        <p id="preview1" ><img id="imghead1" border=0 src=''></p><span></span>
                                        <input type="file" name="pic"  id="image" onchange="previewImage(this,'preview1','imghead1')" style="display:none;" >
                                        <label for="image"  style="float:left;margin-left:35px;margin-top:80px;color:#fff;text-align:center;border-radius:4px;width:120px;height:20px; font-weight:500;line-height:20px;font-size:18px;background:#E40112;padding:4px 6px;cursor:pointer;box-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);">点击更改头像</label>
                                    </div>
                                </td>
                            </tr>
                        </table>
                        <div class="btn" style="float: left;margin-left: 215px;margin-top: 30px;">
                            <input id="ti" type="submit" value="&nbsp;保&nbsp;&nbsp;&nbsp;存" style=" border: hidden; text-align: center;font-size: 18px;border-radius: 4px;font-weight: 500; color: #ffffff; background:#E40112;cursor: pointer;width: 80px;height: 28px;" />
                        </div>
                    </form>
                </div>
        </div>
    </div>

    <div class="right_style r_user_style">
        <!--密码管理-->
        <div class="user_address">
            <div class="title_name"> <span class="name">密码设置</span></div>
            <div class="pwd">
                <form action="{:U('Member/paypwd')}" method="post" id="pwdform">
                <ul class="save">
                    <li>
                        <span>手机号</span>
                        <input type="text" name="mobile"  value=""/>
                    </li>
                    <li>
                        <span>支付密码</span>
                        <input type="password" name="paypwd" value=""/>
                    </li>
                    <li>
                        <input type="button" id="save" value="保存"/>
                    </li>
                </ul>
                </form>
            </div>
        </div>
    </div>
</div>

<!--底部样式-->
<include file="Shop/Home/Common/footer.html"/>
<!--底部样式-->
<!--右侧菜单栏购物车样式-->
<include file="Shop/Home/Common/rightMenu.html"/>
</body>

<!--显示出广告图片-->
<script>
    //图片上传预览    IE是用了滤镜。
    function previewImage(file,pre,imag)
    {
        var MAXWIDTH  = 180;
        var MAXHEIGHT = 180;
        var div = document.getElementById(pre);
        if( !file.value.match( /.jpg|.gif|.png|.bmp/i ) ){
            //$(this).prev('span').text('图片格式无效！');
            $('#'+pre).next('span').css({"color":"red","font-weight":"bold"}).text('图片类型无效！');
            return false;
        }else{
            $('#'+pre).next('span').css({"color":"green","font-weight":"bold"}).text('');
        }
        if (file.files && file.files[0])
        {
            div.innerHTML ='<img id='+imag+'>';
            var img = document.getElementById(imag);
            img.onload = function(){
                var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
                img.width  =  rect.width;
                img.height =  rect.height;
//                 img.style.marginLeft = rect.left+'px';
                img.style.marginTop = rect.top+'px';
            }
            var reader = new FileReader();
            reader.onload = function(evt){img.src = evt.target.result;}
            reader.readAsDataURL(file.files[0]);
        }
        else //兼容IE
        {
            var sFilter='filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src="';
            file.select();
            file.blur();
            var src = document.selection.createRange().text;
            div.innerHTML ='<img id='+imag+'>';
            var img = document.getElementById(imag);
            img.filters.item('DXImageTransform.Microsoft.AlphaImageLoader').src = src;
            var rect = clacImgZoomParam(MAXWIDTH, MAXHEIGHT, img.offsetWidth, img.offsetHeight);
            status =('rect:'+rect.top+','+rect.left+','+rect.width+','+rect.height);
        }

        $(file).next('label').css({margin:0,top:0,position:'absolute',background:'rgba(0,0,0,0.4)',color:'#fff',fontSize:'14px',width:'80px',padding:'3px'}).html('重新选择');
    }
    function clacImgZoomParam( maxWidth, maxHeight, width, height ){
        var param = {top:0, left:0, width:width, height:height};
        if( width>maxWidth || height>maxHeight )
        {
            rateWidth = width / maxWidth;
            rateHeight = height / maxHeight;

            if( rateWidth > rateHeight )
            {
                param.width =  maxWidth;
                param.height = Math.round(height / rateWidth);
            }else
            {
                param.width = Math.round(width / rateHeight);
                param.height = maxHeight;
            }
        }
        param.left = Math.round((maxWidth - param.width) / 2);
        param.top = Math.round((maxHeight - param.height) / 2);
        return param;
    }
</script>
</html>
<script type="text/javascript">
    $(".Section li a span:contains('我的资料')").parent().addClass("on");
    $(".Section li a span:contains('我的特色馆')").parent().removeClass("on");
</script>

<!--支付密码-->
<script type="text/javascript">
    $(function(){
        $("#save").click(function(){
            var id="{$oid|default=''}";
            $.post("{:U('Member/paypwd')}",$("#pwdform").serialize(),function(res){
                if(res.status==1){
                      if(id){
                            layer.msg(res.info,{icon:1,time:1000},function(){location.href="{:U('Orders/Orders')}?id="+id});
                      }else{
                            layer.msg(res.info,{icon:1,time:1000},function(){location.reload()});
                      }
                }else{
                    layer.msg(res.info,{icon:5,time:1000});
                }
            })
        })
    })
</script>